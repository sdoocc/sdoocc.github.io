(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{806:function(e,t,a){"use strict";a.r(t),function(e){a.d(t,"default",function(){return s});var n=a(22),r=a(23),l=a(377),s=function(){function t(){Object(n.a)(this,t),this.player=new l("",{}),this.torrentCallback=null,this.onStartCallback=null}return Object(r.a)(t,[{key:"init",value:function(e,t,a){this.torrentCallback=e,this.onStartCallback=t;var n=a;n||(n=document.querySelector("input[name=upload]")),n&&this.uploadElement(n,this.onStartCallback,function(e,t){if(e)return e;t=t.map(function(e){return e.file}),this.onFiles(t)}.bind(this))}},{key:"isTorrentFile",value:function(e){return-1!==e.name.indexOf(".torrent")}},{key:"isNotTorrentFile",value:function(e){return!this.isTorrentFile(e)}},{key:"onSeedTorrent",value:function(e){e.on("warning",function(e){}),e.on("error",function(e){})}},{key:"seedContent",value:function(t,a,n){var r=e.from(t),l=this.player.seed(r,{name:a});l.on("infoHash",function(e){n(l)})}},{key:"seedOneByOne",value:function(e,t){var a=this;if(console.log("seedOneByOne "+t),e[t]){var n=this.player.seed(e[t],this.onSeedTorrent.bind(this));n.on("infoHash",function(r){a.torrentCallback(n),a.seedOneByOne(e,t+1)})}}},{key:"seed",value:function(e){0!==e.length&&(this.onStartCallback(e),this.seedOneByOne(e,0))}},{key:"onFiles",value:function(e){e.forEach(function(e){}),this.seed(e)}},{key:"uploadElement",value:function(e,t,a,n){"function"===typeof a&&(n=a,a={}),"string"===typeof a&&(a={type:a}),e.addEventListener("change",function(r){if(0===e.files.length)return n(null,[]);t&&t(null);var l=new FileReader,s=0,i=[];function c(t){var n=e.files[t];"text"===a.type?l.readAsText(n):"url"===a.type?l.readAsDataURL(n):l.readAsArrayBuffer(n)}l.addEventListener("load",function(t){i.push({file:e.files[s],target:t.target}),++s===e.files.length?n(null,i):c(s)}),c(s)})}}]),t}()}.call(this,a(6).Buffer)},830:function(e,t,a){"use strict";var n=a(4),r=a(5),l=a(0),s=a.n(l),i=a(1),c=a.n(i),o=a(3),u=a.n(o),d=a(2),m={tag:d.q,className:c.a.any,cssModule:c.a.object},f=function(e){var t=e.className,a=e.cssModule,l=e.tag,i=Object(r.a)(e,["className","cssModule","tag"]),c=Object(d.m)(u()(t,"list-group-item-heading"),a);return s.a.createElement(l,Object(n.a)({},i,{className:c}))};f.propTypes=m,f.defaultProps={tag:"h5"},t.a=f},831:function(e,t,a){"use strict";var n=a(4),r=a(5),l=a(0),s=a.n(l),i=a(1),c=a.n(i),o=a(3),u=a.n(o),d=a(2),m={tag:d.q,className:c.a.any,cssModule:c.a.object},f=function(e){var t=e.className,a=e.cssModule,l=e.tag,i=Object(r.a)(e,["className","cssModule","tag"]),c=Object(d.m)(u()(t,"list-group-item-text"),a);return s.a.createElement(l,Object(n.a)({},i,{className:c}))};f.propTypes=m,f.defaultProps={tag:"p"},t.a=f},846:function(e,t,a){"use strict";a.r(t);var n=a(22),r=a(23),l=a(24),s=a(25),i=a(10),c=a(0),o=a.n(c),u=a(791),d=a(792),m=a(85),f=a(86),h=a(87),p=a(115),E=a(14),y=a(44),v=a(41),g=a(38),b=a(137),k=a(39),w=a(116),S=a(42),N=a(800),O=a(830),M=a(831),T=a(799),B=a(71),j=a(67),L=a(68),q=a(12);function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var a,n=Object(i.a)(e);if(t){var r=Object(i.a)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return Object(s.a)(this,a)}}var C=a(806).default,R=a(229),H=a(12),I=H.getCurrentHost,F=H.startPlayer,P=a(43),D=function(e){Object(l.a)(a,e);var t=x(a);function a(e){var r;return Object(n.a)(this,a),(r=t.call(this,e)).state={resourceList:[],download:null,loadingMsg:"(\u4e0b\u8f7d\u4e2d) ...",showqr:!1,qrName:""},r.state.shareMsg="",r.share=new C(r.state),r.tags="",r.resName="",r.resId="",r.infoInterval=null,r.torrentList=[],r}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=window.location.hash,t=null,a=null;if(e){var n=e.indexOf("#",1);if(n>0){t=e.substr(n+1,64);var r=e.indexOf("#",n+64);r>0&&(a=e.substr(r+1)),t&&64==t.length&&(a?this.setState({download:a}):this.setState({download:t}),this.startDownload(null,t))}}this.share.init(this.onTorrentDone.bind(this),this.onTorrentStart.bind(this))}},{key:"startDownload",value:function(e,t){var a=Object(q.getShareHost)()+"/btb?action=p2pTransfer&resId="+t;R.concat({url:a,json:!0},function(a,n,r){if(a)this.setState({shareMsg:"err.\u51fa\u9519\u4e86"});else if(r.ok){P(15).toString("hex");F(e,{id:t,tags:""})}else this.setState({shareMsg:"\u4e0d\u662f\u514d\u8d39\u8d44\u6e90"})}.bind(this))}},{key:"prettyBytes",value:function(e){var t,a=e<0,n=["B","kB","MB","GB","TB","PB","EB","ZB","YB"];return a&&(e=-e),e<1?(a?"-":"")+e+" B":(t=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),n.length-1),(a?"-":"")+(e=Number((e/Math.pow(1e3,t)).toFixed(2)))+" "+n[t])}},{key:"updateTorrentStatus",value:function(){var e=this;this.torrentList.map(function(t){var a=document.querySelector("#pid"+t.infoHash),n=document.querySelector("#sid"+t.infoHash);a&&(a.innerHTML=t.numPeers),n&&(n.innerHTML=e.prettyBytes(t.uploadSpeed)+"/s")})}},{key:"onTorrentStart",value:function(){this.setState({shareMsg:"\u5904\u7406\u4e2d..."})}},{key:"onTorrentDone",value:function(e){if(e){e.infoHash,e.magnetURI,e.torrentFileBlobURL,e.name;this.resId=e.infoHash,this.resName=e.name;var t=this.state.resourceList;t.push({id:this.resId,name:this.resName}),this.setState({resourceList:t}),e.key=e.infoHash,this.torrentList.unshift(e)}this.infoInterval||(this.infoInterval=setInterval(this.updateTorrentStatus.bind(this),3e3)),this.setState({shareMsg:""})}},{key:"renderAddFile",value:function(){return o.a.createElement(u.a,null,o.a.createElement(d.a,{xs:"12"},o.a.createElement(k.a,null,o.a.createElement(m.a,null,o.a.createElement(f.a,null,o.a.createElement("i",{className:"icon-share"},"\u70b9\u5bf9\u70b9\u6587\u4ef6\u4f20\u8f93"),o.a.createElement("div",{className:"card-header-actions"},o.a.createElement(E.a,{color:"link",className:"card-header-action btn-setting"},o.a.createElement("i",{className:"icon-settings"})))),o.a.createElement(w.a,{isOpen:!0,id:"collapseExample"},o.a.createElement(h.a,null,o.a.createElement("div",null,o.a.createElement("p",null,"\u9009\u62e9\u8981\u4f20\u8f93\u7684\u6587\u4ef6,\u76f4\u63a5\u53d1\u9001\u7ed9\u597d\u53cb\uff0c\u652f\u6301\u624b\u673a\u4e0e\u7535\u8111\u4e4b\u95f4\u9ad8\u901f\u6587\u4ef6\u4f20\u8f93.")),o.a.createElement(S.a,null,o.a.createElement("div",{className:"controls"},o.a.createElement(y.a,{className:"input-prepend"},o.a.createElement(v.a,{addonType:"prepend"},o.a.createElement(g.a,null,"Resource(\u8d44\u6e90):")),o.a.createElement("input",{name:"upload",type:"file"})))),o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement(b.a,{color:"danger"},o.a.createElement("small",null,this.state.shareMsg))))))))))}},{key:"showBarcode",value:function(e,t){this.setState({showqr:!0,qrName:t});var a=I()+"/#/fly#"+e+"#"+t;setTimeout(function(){Object(q.showQRDialog)(a)},1500)}},{key:"copyAddress",value:function(e){var t=document.querySelector("#url_"+e);t.focus(),t.select();var a=document.execCommand("copy"),n=document.querySelector("#msg_"+e);n.innerHTML=a?"OK.\u590d\u5236\u6210\u529f":"\u590d\u5236\u5931\u8d25\uff0c\u8bf7\u624b\u52a8\u590d\u5236"}},{key:"renderResourceItems",value:function(){var e=this;return this.state.resourceList.map(function(t){var a="pid"+t.id,n="sid"+t.id;return o.a.createElement(N.a,{key:t.id,action:!0},o.a.createElement(O.a,null," ",o.a.createElement("i",{className:"fa fa-barcode",onClick:function(a){return e.showBarcode(t.id,t.name)}}),o.a.createElement("span",null," ",t.name," : \u8bf7\u5c06\u4e0b\u9762\u5730\u5740\u53d1\u7ed9\u597d\u53cb\u4e0b\u8f7d"),o.a.createElement(E.a,{color:"ghost-success",onClick:function(a){return e.copyAddress(t.id)}},o.a.createElement("i",{className:"fa fa-copy fa-lg"}),"\xa0\u590d\u5236\u5730\u5740"),o.a.createElement("span",{className:"alert-primary",id:"msg_"+t.id})),o.a.createElement(O.a,null,o.a.createElement("input",{readOnly:!0,style:{width:"100%"},id:"url_"+t.id,value:I()+"/#/fly#"+t.id+"#"+t.name})),o.a.createElement(M.a,null,o.a.createElement("code",null," ",o.a.createElement("span",{id:a}),"\u8282\u70b9"),". \u2197",o.a.createElement("code",null,o.a.createElement("span",{id:n}),"\u4e0a\u4f20\u901f\u5ea6")))})}},{key:"toggle",value:function(){this.setState({showqr:!this.state.showqr})}},{key:"renderShareList",value:function(){return o.a.createElement(u.a,null,o.a.createElement(d.a,{sm:"12",xl:"6"},o.a.createElement(m.a,null,o.a.createElement(f.a,null,o.a.createElement("i",{className:"fa fa-align-justify"}),o.a.createElement("strong",null,"Transfer List(\u4f20\u8f93\u5217\u8868"),o.a.createElement(b.a,{color:"danger"},o.a.createElement("small",null,"\u8d44\u6e90\u4e0d\u4f1a\u4e0a\u4f20\u7ed9\u4efb\u4f55\u670d\u52a1\u5668\uff0c\u70b9\u5bf9\u70b9\u76f4\u63a5\u4ece\u672c\u5730\u4e0b\u8f7d\u3002Please keep this page open.\u8bf7\u4e0d\u8981\u5237\u65b0\u6216\u5173\u95ed\u6b64\u9875\u9762\uff0c\u4fdd\u6301\u6b64\u9875\u9762\u6253\u5f00\u72b6\u6001\u4e0b\uff0c\u6587\u4ef6\u4f20\u8f93\u624d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002\u9875\u9762\u5f02\u5e38\u60c5\u51b5\u53ef\u4ee5\u91cd\u65b0\u9009\u62e9\u6587\u4ef6\u7ee7\u7eed\u4f20\u8f93\u3002"))),o.a.createElement(h.a,null,o.a.createElement(T.a,null,this.renderResourceItems()),o.a.createElement(B.a,{isOpen:this.state.showqr,className:this.props.className},o.a.createElement(j.a,{toggle:this.toggle.bind(this)},this.state.qrName),o.a.createElement(L.a,null,o.a.createElement("div",{id:"qrcode"})))))))}},{key:"renderPlayer",value:function(){return this.state.download?o.a.createElement("div",{id:"playdiv"},o.a.createElement(m.a,null,o.a.createElement(f.a,null,this.state.download,o.a.createElement(p.a,{color:"success",className:"float-right"},this.state.loadingMsg)),o.a.createElement(h.a,null,o.a.createElement("div",{id:"status"},o.a.createElement("div",null,o.a.createElement("span",{className:"show-leech"}," from "),o.a.createElement("code",{id:"numPeers"},"0 peers"),".",o.a.createElement("code",{id:"downloadSpeed"},"0 b/s ")," / \u2197",o.a.createElement("code",{id:"uploadSpeed"},"0 b/s - "),o.a.createElement("code",{id:"downloaded"})," of",o.a.createElement("code",{id:"total"})," \u2014",o.a.createElement("span",{id:"remaining"}))),o.a.createElement("div",{id:"player",style:{width:"100%"}})))):null}},{key:"render",value:function(){return o.a.createElement("div",{className:"animated fadeIn"},this.renderPlayer(),this.renderAddFile(),this.renderShareList())}}]),a}(c.Component);t.default=D}}]);